<app-header [showMenu]="true" title="Perfil"></app-header>

<ion-content class="perfil-page ion-padding">

  <!-- CARD TUTOR -->
  <div class="tutor-card">

    <!-- Zona avatar tutor -->
    <div class="tutor-avatar">
      <div class="avatar-circle" (click)="takeImage()">
        <img *ngIf="user()?.image" [src]="user()?.image" />
        <ion-icon *ngIf="!user()?.image" name="person-circle-outline"></ion-icon>
      </div>

      <button class="change-photo-btn" (click)="takeImage()">
        Cambiar foto de perfil
      </button>
    </div>

    <!-- Datos tutor + botones -->
    <div class="tutor-info">

      <div class="tutor-text">
        <p><span>Nombre:</span> {{ user()?.name || '-' }}</p>
        <p><span>Apellido:</span> {{ user()?.lastName || '-' }}</p>
        <p><span>Rol:</span> Tutor BabyLog</p>
        <p><span>Teléfono:</span> {{ user()?.phone || '-' }}</p>
        <p><span>Correo:</span> {{ user()?.email || '-' }}</p>
      </div>

      <div class="tutor-actions">
        <ion-button size="small" mode="ios" (click)="editTutorProfile()">
          <ion-icon name="create-outline" slot="start"></ion-icon>
          Editar perfil
        </ion-button>

        <ion-button size="small" mode="ios" color="secondary" (click)="addBaby()">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Agregar bebé
        </ion-button>
      </div>

    </div>
  </div>

  <!-- GRID DE BEBÉS -->
  <h2 class="section-title" *ngIf="babies?.length">Bebés registrados</h2>

  <div class="babies-grid" *ngIf="babies?.length; else noBabies">
    <div class="baby-card" *ngFor="let baby of babies">

      <!-- Foto bebé -->
      <div class="baby-avatar" (click)="changeBabyPhoto(baby)">
        <div class="avatar-circle">
          <img *ngIf="baby.photo" [src]="baby.photo" />
          <ion-icon *ngIf="!baby.photo" name="image-outline"></ion-icon>
        </div>
        <p class="change-photo-label">Cambiar foto de perfil</p>
      </div>

      <!-- Datos bebé -->
      <div class="baby-info">
        <p *ngIf="baby.isFavorite" class="favorite-label">
          ⭐ Bebé principal
        </p>
        <p><span>Nombre del bebé:</span> {{ baby.firstName || '-' }}</p>
        <p><span>Apellido del bebé:</span> {{ baby.lastName || '-' }}</p>
        <p><span>Fecha de nacimiento:</span> {{ baby.birthDate || '-' }}</p>
        <p><span>Peso:</span> {{ baby.weight || '-' }}</p>
        <p><span>Estatura:</span> {{ baby.height || '-' }}</p>
        <p><span>Tipo de sangre:</span> {{ baby.bloodType || '-' }}</p>
        <p><span>Alergias:</span> {{ baby.allergies || '-' }}</p>
      </div>

      <!-- Botones bebé -->
      <div class="baby-actions">
        <ion-button mode="ios" size="small" fill="clear" (click)="setFavorite(baby)">
          <ion-icon [name]="baby.isFavorite ? 'star' : 'star-outline'" slot="start"></ion-icon>
          {{ baby.isFavorite ? 'Bebé principal' : 'Marcar como principal' }}
        </ion-button>

        <ion-button mode="ios" size="small" (click)="editBaby(baby)">
          Actualizar datos
        </ion-button>
      </div>
    </div>
  </div>

  <ng-template #noBabies>
    <p class="empty-text">
      Aún no tienes bebés registrados. Usa el botón <strong>“Agregar bebé”</strong> para crear uno.
    </p>
  </ng-template>

  <!-- BOTONES INFERIORES -->
  <div class="bottom-buttons">
    <ion-button expand="block" mode="ios" fill="outline" (click)="goToTerms()">
      Términos &amp; condiciones de uso
    </ion-button>

    <ion-button expand="block" mode="ios" fill="outline" (click)="goToHelpDesk()">
      Mesa de ayuda
    </ion-button>
  </div>

</ion-content>
