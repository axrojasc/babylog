<app-header [showMenu]="true" title="BabyLog"></app-header>

<ion-content class="home-dashboard">

  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- HERO / PERFIL -->
  <div class="hero-card" *ngIf="!loading && image.length">

    <div class="hero-top">
      <div class="hero-avatar-wrapper">
        <ion-avatar class="hero-avatar">
          <img [src]="image[0]?.image" (click)="addUpdateImage()" />
        </ion-avatar>
      </div>

      <div class="hero-info">
        <h2 class="hero-name">{{ image[0]?.name }}</h2>
        <p class="hero-subtitle">Registro pediátrico</p>

        <div class="hero-badges">
          <span class="badge badge-primary">Controles al día</span>
          <span class="badge badge-soft">Vacunas próximas</span>
        </div>

        <div class="hero-actions">
          <ion-button size="small" fill="solid" color="light" (click)="addUpdateImage(image[0])">
            <ion-icon slot="start" name="create-outline"></ion-icon>
            Editar
          </ion-button>

          <ion-button size="small" fill="clear" color="danger" (click)="confirmDelete(image[0])">
            <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
          </ion-button>
        </div>
      </div>
    </div>

    <div class="hero-bottom">
      <div class="hero-stat">
        <span class="hero-stat-label">Sueño promedio</span>
        <span class="hero-stat-value">{{ ultimoSueno || 'Sin registro' }}</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-label">Próxima vacuna</span>
        <span class="hero-stat-value">
          {{ proximaVacunaNombre ? proximaVacunaNombre + ' - ' : '' }}{{ proximaVacuna || 'Sin registro' }}
        </span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-label">Próximo control</span>
        <span class="hero-stat-value">
          {{ proximoControlNombre ? proximoControlNombre + ' - ' : '' }}{{ proximoControl || 'Sin registro' }}
        </span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-label">Última comida</span>
        <span class="hero-stat-value">
          {{ ultimaComida ? ultimaComida + ' - ' : '' }}{{ ultimaComidaCantidad || 'Sin registro' }}
        </span>
      </div>
    </div>
  </div>

  <div class="hero-empty" *ngIf="!loading && !image.length">
    <h2>Bienvenido a BabyLog</h2>
    <p>Crea el perfil de tu bebé para comenzar a registrar su crecimiento.</p>
    <ion-button (click)="addUpdateImage()">Crear perfil</ion-button>
  </div>

  <div class="section-header" *ngIf="!loading">
    <h3>Resumen de hoy</h3>
  </div>

  <ion-grid *ngIf="!loading">
    <ion-row>

      <!-- Sueño -->
      <ion-col size="6">
        <ion-card class="kpi-card kpi-sleep" (click)="goToSueno()">
          <ion-card-content>
            <div class="kpi-icon">
              <ion-icon name="moon-outline"></ion-icon>
            </div>
            <div class="kpi-title">Sueño</div>
            <div class="kpi-value">{{ ultimoSueno || 'Sin registro' }}</div>
            <div class="kpi-subtitle">Última duración</div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Vacunas -->
      <ion-col size="6">
        <ion-card class="kpi-card kpi-vacunas" (click)="goToVacunas()">
          <ion-card-content>
            <div class="kpi-icon">
              <ion-icon name="bandage-outline"></ion-icon>
            </div>
            <div class="kpi-title">Vacunas</div>
            <div class="kpi-value">
              {{ proximaVacunaNombre ? proximaVacunaNombre + ' - ' : '' }}{{ proximaVacuna || 'Sin registro' }}
            </div>
            <div class="kpi-subtitle">Próxima dosis</div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Controles -->
      <ion-col size="6">
        <ion-card class="kpi-card kpi-controles" (click)="goToControles()">
          <ion-card-content>
            <div class="kpi-icon">
              <ion-icon name="calendar-outline"></ion-icon>
            </div>
            <div class="kpi-title">Controles</div>
            <div class="kpi-value">
              {{ proximoControlNombre ? proximoControlNombre + ' - ' : '' }}{{ proximoControl || 'Sin registro' }}
            </div>
            <div class="kpi-subtitle">Próximo control</div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Alimentación -->
      <ion-col size="6">
        <ion-card class="kpi-card kpi-peso" (click)="goToPeso()">
          <ion-card-content>
            <div class="kpi-icon">
              <ion-icon name="fast-food-outline"></ion-icon>
            </div>
            <div class="kpi-title">Alimentación</div>
            <div class="kpi-value">
              {{ ultimaComida ? ultimaComida + ' - ' : '' }}{{ ultimaComidaCantidad || 'Sin registro' }}
            </div>
            <div class="kpi-subtitle">Última comida</div>
          </ion-card-content>
        </ion-card>
      </ion-col>

      <!-- Crecimiento -->
      <ion-col size="6">
        <ion-card class="kpi-card kpi-altura" (click)="goToCrecimiento()">
          <ion-card-content>
            <div class="kpi-icon">
              <ion-icon name="accessibility-outline"></ion-icon>
            </div>
            <div class="kpi-title">Crecimiento</div>
            <div class="kpi-value">
              {{ ultimoPeso ? ultimoPeso + ' kg - ' : '' }}{{ ultimaAltura || 'Sin registro' }}{{ ultimaAltura ? ' cm' : '' }}
            </div>
            <div class="kpi-subtitle">Peso y altura</div>
          </ion-card-content>
        </ion-card>
      </ion-col>

    </ion-row>
  </ion-grid>

</ion-content>
